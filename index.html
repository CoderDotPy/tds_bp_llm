<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LLM Agent POC ‚Äî Browser Multi-Tool</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
      body { background: #0d1117; color: #f0f6fc; font-family: "Inter", system-ui, sans-serif; height: 100vh; display: flex; flex-direction: column; }
      .form-control, .form-select { background:#161b22; color:#f0f6fc; border:1px solid #30363d; border-radius:.75rem; }
      .form-control::placeholder, .form-select::placeholder { color:#c9d1d9; opacity:1; }
      .form-control:focus, .form-select:focus { border-color:#58a6ff; box-shadow: 0 0 0 .25rem rgba(56,139,253,.25); }
      .btn-primary { background:#238636; border-color:#238636; border-radius:.75rem; font-weight:500; }
      .btn-primary:hover { background:#2ea043; border-color:#2ea043; }
      .btn-outline { border:1px solid #30363d; color:#f0f6fc; border-radius:.75rem; }
      .btn-outline:hover { background:#21262d; }
      #chat-container { flex: 1; display: flex; flex-direction: column; background: transparent; }
      #chat { flex: 1; overflow-y: auto; padding:.5rem; }
      .msg-user { background:#1f6feb20; border-left: 4px solid #1f6feb; border-radius: 1rem; padding:.5rem; margin-bottom:.5rem; }
      .msg-assistant { background:#23863620; border-left: 4px solid #238636; border-radius: 1rem; padding:.5rem; margin-bottom:.5rem; }
      .msg-tool { background:#bb800920; border-left: 4px solid #bb8009; border-radius: 1rem; padding:.5rem; margin-bottom:.5rem; }
      pre { white-space: pre-wrap; }
      #chat-input-bar { background: transparent; border-top:none; padding:.75rem; position: sticky; bottom:0; display:flex; gap:.5rem; }
      #userInput { flex:1; border-radius:.75rem; padding-left:1rem; padding-right:1rem; font-size:1rem; height:3.25rem; }
      #sendBtn, #resetBtn { border-radius:.75rem; padding:0 1.25rem; font-size:1rem; }
      .section-header { font-size:2rem; font-weight:800; margin-bottom:1rem; display: flex; align-items: center; gap:.5rem; }
      .config-section { margin-bottom:2rem; }
      .tooltip-icon { margin-left:.5rem; cursor:pointer; color:#58a6ff; }
    </style>
  </head>
  <body>
    <div class="container py-4 d-flex flex-column flex-grow-1" style="max-width: 960px;">
      <div id="alerts"></div>
      <div class="text-center mb-5">
        <h1 class="h2">‚ö° LLM Agent POC</h1>
      </div>

      <!-- Two-column layout: Provider left, Tools right -->
      <div class="row mb-4">
        <div class="col-md-6 config-section">
          <div class="section-header">Model Provider ü§ñ</div>
          <div>
            <select id="providerPreset" class="form-select mb-2">
              <option value="openai">OpenAI-compatible</option>
              <option value="anthropic">Anthropic-compatible (proxy)</option>
              <option value="local">Local/OpenRouter-compatible</option>
            </select>
            <input id="baseUrl" class="form-control mb-2" placeholder="https://api.openai.com/v1" />
            <input id="apiKey" class="form-control mb-2" placeholder="sk-..." />
            <input id="model" class="form-control mb-2" placeholder="gpt-4o-mini" />
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="stream">
              <label class="form-check-label smalllabel" for="stream">Stream <span class="tooltip-icon" data-bs-toggle="tooltip" title="Stream: If enabled, responses are streamed token by token instead of waiting for the full answer.">‚ùì</span></label>
            </div>
          </div>
        </div>

        <div class="col-md-6 config-section">
          <div class="section-header">Tools üõ†Ô∏è</div>
          <div>
            <div class="form-check form-switch mb-2">
              <input class="form-check-input" type="checkbox" id="enableSearch">
              <label class="form-check-label smalllabel" for="enableSearch">Google Search <span class="tooltip-icon" data-bs-toggle="tooltip" title="Uses Google Custom Search API to fetch snippet results.">‚ùì</span></label>
            </div>
            <input id="googleKey" class="form-control mb-2" placeholder="API Key" />
            <input id="googleCx" class="form-control mb-2" placeholder="CSE CX" />
            <input id="googleNum" type="number" min="1" max="10" value="5" class="form-control mb-2" />
            <div class="form-check form-switch mb-2">
              <input class="form-check-input" type="checkbox" id="enableAIPipe" checked>
              <label class="form-check-label smalllabel" for="enableAIPipe">AI Pipe <span class="tooltip-icon" data-bs-toggle="tooltip" title="AI Pipe: A proxy API for flexible workflows and dataflows.">‚ùì</span></label>
            </div>
            <input id="aipipeBase" class="form-control mb-2" placeholder="AI Pipe URL" />
            <input id="aipipeToken" class="form-control mb-2" placeholder="Token" />
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="enableJSExec">
              <label class="form-check-label smalllabel" for="enableJSExec">JS Exec <span class="tooltip-icon" data-bs-toggle="tooltip" title="JS Exec: Runs small JavaScript snippets securely in-browser and shows results.">‚ùì</span></label>
            </div>
          </div>
        </div>
      </div>

      <!-- Chat -->
      <div id="chat-container" class="flex-grow-1 d-flex flex-column">
        <div id="chat" class="flex-grow-1 mb-0"></div>
        <div id="chat-input-bar" class="input-group">
          <input id="userInput" class="form-control" placeholder="Type your message..." />
          <button id="sendBtn" class="btn btn-primary">Send</button>
          <button id="resetBtn" class="btn btn-outline">Reset</button>
        </div>
      </div>

      <div class="mt-3 smalllabel">üí° Try: <code class="mono">Interview me to create a blog post.</code></div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Tooltips init
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });

  // Chat handling

  const chat = document.getElementById('chat');
  const userInput = document.getElementById('userInput');
  const sendBtn = document.getElementById('sendBtn');
  const resetBtn = document.getElementById('resetBtn');

  function appendMessage(sender, text) {
    const div = document.createElement('div');
    div.className = sender === 'user' ? 'msg-user' : (sender === 'tool' ? 'msg-tool' : 'msg-assistant');
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  // JS Exec Sandbox
  function runJSSandbox(code) {
    return new Promise((resolve) => {
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      iframe.sandbox = 'allow-scripts';
      document.body.appendChild(iframe);

      iframe.contentWindow.console.log = (...args) => resolve(args.join(' '));
      iframe.contentWindow.onerror = (e) => resolve('‚ùå ' + e.message);

      const script = iframe.contentDocument.createElement('script');
      script.textContent = code;
      iframe.contentDocument.body.appendChild(script);

      setTimeout(() => {
        document.body.removeChild(iframe);
        resolve('(Execution complete)');
      }, 1000);
    });
  }

  async function sendMessageToBackend(message) {
  const baseUrl = document.getElementById('aipipeBase').value.trim();
  const token = document.getElementById('aipipeToken').value.trim();
  const model = document.getElementById('model').value.trim() || "gpt-4o-mini";
  const enableSearch = document.getElementById('enableSearch').checked;

  // If AI Pipe URL and token are provided, bypass model provider check
  if (!baseUrl || !token) {
    appendMessage('assistant', '‚ö†Ô∏è Please enter AI Pipe URL and Token first.');
    return;
  }

  let augmentedMessage = message;

  // If Google Search enabled, prepend top results
  if (enableSearch) {
    const searchResults = await performGoogleSearch(message);
    augmentedMessage = `Here are Google search results relevant to the query:\n${searchResults}\n\nUser query: ${message}`;
  }

  try {
    const response = await fetch(baseUrl + "/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({
        model: model,
        messages: [{ role: "user", content: augmentedMessage }]
      })
    });

    if (!response.ok) {
      appendMessage('assistant', '‚ùå Error: ' + response.status + ' ' + response.statusText);
      return;
    }

    const data = await response.json();
    const reply = data.choices?.[0]?.message?.content || "(No response)";
    appendMessage('assistant', reply);
  } catch (err) {
    appendMessage('assistant', '‚ùå Request failed: ' + err.message);
  }
}


  sendBtn.addEventListener('click', () => {
    const text = userInput.value.trim();
    if (!text) return;
    appendMessage('user', text);
    userInput.value = '';
    sendMessageToBackend(text);
  });

  resetBtn.addEventListener('click', () => {
    chat.innerHTML = '';
  });
</script>


  </body>
</html>
